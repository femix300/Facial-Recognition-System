{% extends 'attendance/base.html' %}
{% block title %}Login{% endblock %}

{% block content %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
    :root {
        --primary-color: #0056b3;
        --light-bg: #f8f9fa;
        --body-bg: #eef2f9;
        --card-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
    }
    body, .btn {
        font-family: 'Poppins', sans-serif;
    }
    .login-container {
        min-height: 85vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .login-card {
        border-radius: 1rem;
        box-shadow: var(--card-shadow);
        overflow: hidden;
        border: none;
        animation: fadeIn 0.8s ease-in-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .branding-panel {
        background: linear-gradient(135deg, #007bff, var(--primary-color));
        color: white;
        padding: 3rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;
    }
    .branding-panel .icon {
        font-size: 5rem;
        margin-bottom: 1rem;
    }
    .branding-panel h2 {
        font-weight: 700;
    }
    .form-panel {
        padding: 3rem;
    }
    .input-group-text {
        background-color: transparent;
        border-right: 0;
    }
    .form-control {
        border-left: 0;
    }
    .form-control:focus {
        box-shadow: none;
        border-color: #dee2e6;
    }
</style>

<div class="login-container">
    <div class="container">
        <div class="login-card">
            <div class="row g-0">
                <div class="col-lg-5 d-none d-lg-flex branding-panel">
                    <div>
                        <div class="icon"><i class="bi bi-person-bounding-box"></i></div>
                        <h2 class="mb-3">Welcome Back</h2>
                        <p>Securely access your personalized attendance dashboard.</p>
                    </div>
                </div>

                <div class="col-lg-7">
                    <div class="form-panel">
                        <h1 class="fw-bold mb-4">Secure Login</h1>
                        {% if messages %}{% for message in messages %}<div class="alert alert-danger">{{ message }}</div>{% endfor %}{% endif %}

                        <form method="post" novalidate>
                            {% csrf_token %}

                            <label class="form-label fw-bold">I am a:</label>
                            <div class="mb-3">
                                {% for radio in form.user_type %}
                                <div class="form-check form-check-inline">
                                    {{ radio.tag }}
                                    <label class="form-check-label" for="{{ radio.id_for_label }}">{{ radio.choice_label }}</label>
                                </div>
                                {% endfor %}
                            </div>

                            <label class="form-label fw-bold">Email address</label>
                            <div class="input-group mb-3">
                                <span class="input-group-text"><i class="bi bi-envelope-fill"></i></span>
                                {{ form.email }}
                            </div>

                            <label class="form-label fw-bold">Password</label>
                            <div class="input-group mb-4">
                                <span class="input-group-text"><i class="bi bi-key-fill"></i></span>
                                {{ form.password }}
                                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="#id_password">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>

                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <a href="{% url 'forgot_password' %}"><small>Forgot Password?</small></a>
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg fw-bold">Login</button>
                            </div>
                        </form>

                        <div class="text-center mt-4">
                            <small class="text-muted">
                                <a href="{% url 'student_registration' %}">Register as a Student</a>
                                <span class="mx-2">|</span>
                                <a href="{% url 'lecturer_registration' %}">Register as a Lecturer</a>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Select all buttons with the class 'toggle-password'
        const togglePasswordButtons = document.querySelectorAll('.toggle-password');

        togglePasswordButtons.forEach(button => {
            button.addEventListener('click', function () {
                // The data-target attribute should point to the ID of the password input.
                // Django forms automatically generate IDs like 'id_fieldname', so '#id_password' is correct.
                const targetInput = document.querySelector(this.dataset.target);
                const icon = this.querySelector('i');

                if (targetInput) {
                    // Switch the type between 'password' and 'text'
                    const newType = targetInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    targetInput.setAttribute('type', newType);

                    // Switch the icon class between 'bi-eye' and 'bi-eye-slash'
                    icon.classList.toggle('bi-eye');
                    icon.classList.toggle('bi-eye-slash');
                }
            });
        });
    });
</script>
{% endblock %}
